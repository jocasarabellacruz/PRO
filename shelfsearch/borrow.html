<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borrow a Book</title>
    <link rel="stylesheet" href="borrow.css">
    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header>
        <h1>HELLO, JOCAS ARABELLA!</h1>
        <div class="digital-clock" id="digitalClock"></div>
    </header>

    <!-- Main Section -->
    <main>
        <h2>BORROW A BOOK</h2>
        <div class="container">
            <!-- Left Side: Book Record -->
            <section class="book-record">
                <h3>BOOK RECORD</h3>
                <table>
                    <tr>
                        <th>Book Title</th>
                        <th>Status</th>
                        <th>Date Borrowed</th>
                        <th>Date Returned</th>
                    </tr>
                    <?php
                    // Include database connection
                    include 'php/conn.php';

                    // Replace this with the dynamic student ID from session or request
                    $studentID = 202201798; 

                    // Fetch book records for the student
                    $query = "SELECT b.title, br.bookstatus, br.dateBorrowed, br.dateReturned
                              FROM bookrecord br
                              JOIN books b ON br.barcode = b.barcode
                              WHERE br.studentID = $studentID";

                    $result = mysqli_query($conn, $query);

                    if (mysqli_num_rows($result) > 0) {
                        while ($row = mysqli_fetch_assoc($result)) {
                            echo "<tr>
                                    <td>" . htmlspecialchars($row['title']) . "</td>
                                    <td>" . htmlspecialchars($row['bookstatus']) . "</td>
                                    <td>" . htmlspecialchars($row['dateBorrowed'] ?? '-') . "</td>
                                    <td>" . htmlspecialchars($row['dateReturned'] ?? '-') . "</td>
                                  </tr>";
                        }
                    } else {
                        echo "<tr><td colspan='4'>No records found</td></tr>";
                    }
                    ?>
                </table>
                <div class="navigation">
                    <button class="btn left">&larr;</button>
                    <button class="btn right">&rarr;</button>
                </div>
            </section>

            <!-- Right Side: Scanning Section -->
            <section class="scanning-section">
                <div class="loader"></div>
                <p class="scanning-text">Scanning Book...</p>
                <p class="manual-text">Canâ€™t scan book? Manually input book barcode here:</p>

                <!-- Borrow Book Form -->
                <form action="php/borrowBook.php" method="POST">
                    <input type="hidden" name="studentID" value="202201798"> <!-- Replace with dynamic student ID -->
                    <input type="text" name="barcode" placeholder="Enter Book Barcode" required>
                    <button type="submit" class="manual-input">Borrow Book</button>
                </form>

                <!-- Return Book Form -->
                <form action="php/returnBook.php" method="POST">
                    <input type="hidden" name="studentID" value="202201798"> <!-- Replace with dynamic student ID -->
                    <input type="text" name="barcode" placeholder="Enter Book Barcode" required>
                    <button type="submit" class="manual-input">Return Book</button>
                </form>
            </section>
        </div>
    </main>

    <!-- Return Button -->
    <a href="main.html" class="return-btn">Return</a>

    <!-- JavaScript -->
    <script>
        // Digital Clock
        function updateClock() {
            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();

            document.getElementById('digitalClock').textContent = `${date} ${time}`;
        }

        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
